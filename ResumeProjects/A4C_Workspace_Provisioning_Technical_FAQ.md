# A4C Workspace Provisioning Service - Technical FAQ

## Quick Reference: System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       A4C SYSTEM ARCHITECTURE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚   Developer  â”‚                                                          â”‚
â”‚   â”‚   (Client)   â”‚                                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚          â”‚                                                                   â”‚
â”‚          â”‚ POST /v1/users/{userId}/workspaces                               â”‚
â”‚          â–¼                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚   â”‚  A4C Service â”‚â—„â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Disk Service â”‚                                 â”‚
â”‚   â”‚  (API + Logic)â”‚         â”‚(Server Stats)â”‚                                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
â”‚          â”‚                                                                   â”‚
â”‚          â”‚ Select server with least disk usage                              â”‚
â”‚          â–¼                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚                    DOCKER HOST POOL                               â”‚      â”‚
â”‚   â”‚                                                                   â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚      â”‚
â”‚   â”‚  â”‚   Server 1     â”‚  â”‚   Server 2     â”‚  â”‚   Server 3     â”‚     â”‚      â”‚
â”‚   â”‚  â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚  â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚  â”‚ â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”  â”‚     â”‚      â”‚
â”‚   â”‚  â”‚ â”‚WS-1â”‚ â”‚WS-2â”‚  â”‚  â”‚ â”‚WS-3â”‚ â”‚WS-4â”‚  â”‚  â”‚ â”‚WS-5â”‚ â”‚WS-6â”‚  â”‚     â”‚      â”‚
â”‚   â”‚  â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚  â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚  â”‚ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜  â”‚     â”‚      â”‚
â”‚   â”‚  â”‚  Docker Daemon â”‚  â”‚  Docker Daemon â”‚  â”‚  Docker Daemon â”‚     â”‚      â”‚
â”‚   â”‚  â”‚  Disk: 60%     â”‚  â”‚  Disk: 45%     â”‚  â”‚  Disk: 80%     â”‚     â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚      â”‚
â”‚   â”‚                                                                   â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚          â”‚                                                                   â”‚
â”‚          â”‚ Store workspace metadata                                          â”‚
â”‚          â–¼                                                                   â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚   â”‚  PostgreSQL  â”‚  (Primary + Replicas)                                    â”‚
â”‚   â”‚  (Metadata)  â”‚                                                          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚   IMAGE BUILDING FLOW:                                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â”‚ Build Request â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          BUILD SCHEDULE TABLE        â”‚         â”‚
â”‚   â”‚              â”‚         â”‚  id | project | status    | worker   â”‚         â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  1  | proj-A  | SCHEDULED | null     â”‚         â”‚
â”‚                            â”‚  2  | proj-B  | IN_PROGRESS| worker-1â”‚         â”‚
â”‚                            â”‚  3  | proj-C  | COMPLETED | worker-2 â”‚         â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                        â–²                                    â”‚
â”‚                                        â”‚ Poll for work                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚                    BARE-METAL WORKERS                             â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚      â”‚
â”‚   â”‚  â”‚  Worker 1  â”‚  â”‚  Worker 2  â”‚  â”‚  Worker 3  â”‚                  â”‚      â”‚
â”‚   â”‚  â”‚ (Building) â”‚  â”‚ (Idle)     â”‚  â”‚ (Building) â”‚                  â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Part 1: Foundation Questions

### Q1: What problem did this system solve?

**Simple Analogy:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BEFORE: Shared Apartment                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚   â”‚                     SHARED SERVER                                â”‚       â”‚
â”‚   â”‚                                                                  â”‚       â”‚
â”‚   â”‚   ğŸ‘¤ Dev-A: "I need Python 3.8"                                  â”‚       â”‚
â”‚   â”‚   ğŸ‘¤ Dev-B: "I need Python 3.10" â†’ CONFLICT!                     â”‚       â”‚
â”‚   â”‚   ğŸ‘¤ Dev-C: "Who deleted my files??"                             â”‚       â”‚
â”‚   â”‚   ğŸ‘¤ Dev-D: "Server is slow, someone's using all CPU!"           â”‚       â”‚
â”‚   â”‚                                                                  â”‚       â”‚
â”‚   â”‚   Problems:                                                       â”‚       â”‚
â”‚   â”‚   âŒ Resource contention (CPU, memory, disk)                      â”‚       â”‚
â”‚   â”‚   âŒ Environment conflicts (different tool versions)              â”‚       â”‚
â”‚   â”‚   âŒ No isolation (can see/modify others' files)                  â”‚       â”‚
â”‚   â”‚   âŒ Manual setup (days to configure new environment)             â”‚       â”‚
â”‚   â”‚   âŒ "Works on my machine" syndrome                               â”‚       â”‚
â”‚   â”‚                                                                  â”‚       â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AFTER: Individual Apartments (Containers)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚   Dev-A's     â”‚  â”‚   Dev-B's     â”‚  â”‚   Dev-C's     â”‚                  â”‚
â”‚   â”‚   Workspace   â”‚  â”‚   Workspace   â”‚  â”‚   Workspace   â”‚                  â”‚
â”‚   â”‚               â”‚  â”‚               â”‚  â”‚               â”‚                  â”‚
â”‚   â”‚  Python 3.8   â”‚  â”‚  Python 3.10  â”‚  â”‚  Python 3.9   â”‚                  â”‚
â”‚   â”‚  Own files    â”‚  â”‚  Own files    â”‚  â”‚  Own files    â”‚                  â”‚
â”‚   â”‚  Guaranteed   â”‚  â”‚  Guaranteed   â”‚  â”‚  Guaranteed   â”‚                  â”‚
â”‚   â”‚  resources    â”‚  â”‚  resources    â”‚  â”‚  resources    â”‚                  â”‚
â”‚   â”‚               â”‚  â”‚               â”‚  â”‚               â”‚                  â”‚
â”‚   â”‚  âœ… Isolated   â”‚  â”‚  âœ… Isolated   â”‚  â”‚  âœ… Isolated   â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                                                              â”‚
â”‚   Benefits:                                                                  â”‚
â”‚   âœ… Complete isolation (can't affect others)                               â”‚
â”‚   âœ… Custom environments (any tools, any version)                           â”‚
â”‚   âœ… Guaranteed resources (CPU, memory quotas)                              â”‚
â”‚   âœ… Fast provisioning (< 2 minutes vs. days)                               â”‚
â”‚   âœ… Reproducible (same image = same environment)                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q2: Walk me through the workspace creation flow.

**Step-by-Step Flow:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WORKSPACE CREATION FLOW                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  REQUEST:                                                                    â”‚
â”‚  POST /v1/users/user-123/workspaces                                         â”‚
â”‚  {                                                                           â”‚
â”‚    "projectName": "backend-api",                                            â”‚
â”‚    "arch": "linux-x64",                                                      â”‚
â”‚    "changeNumber": "CL-45678"                                               â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  STEP 1: Find Servers with Required Image (10ms)                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚                                                                              â”‚
â”‚  A4C Service: "Which servers have image for backend-api on linux-x64?"     â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Query image registry:                                        â”‚            â”‚
â”‚  â”‚                                                               â”‚            â”‚
â”‚  â”‚ SELECT server_id FROM images                                  â”‚            â”‚
â”‚  â”‚ WHERE project = 'backend-api' AND arch = 'linux-x64'         â”‚            â”‚
â”‚  â”‚                                                               â”‚            â”‚
â”‚  â”‚ Result: [server-1, server-2, server-4]                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  STEP 2: Select Best Server via Disk Service (20ms)                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”‚
â”‚                                                                              â”‚
â”‚  A4C â†’ Disk Service: "Of [server-1, server-2, server-4], which is best?"   â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Disk Service checks each server:                             â”‚            â”‚
â”‚  â”‚                                                               â”‚            â”‚
â”‚  â”‚ server-1: disk 75%, memory 60%  â”‚                            â”‚            â”‚
â”‚  â”‚ server-2: disk 45%, memory 50%  â”‚ â† Lowest disk! Selected    â”‚            â”‚
â”‚  â”‚ server-4: disk 80%, memory 70%  â”‚                            â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  STEP 3: Create Container via Docker Daemon (30-60s)                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”‚
â”‚                                                                              â”‚
â”‚  A4C connects to server-2's Docker daemon:                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ docker run -d \                                               â”‚            â”‚
â”‚  â”‚   --name workspace-user123-abc \                              â”‚            â”‚
â”‚  â”‚   --hostname dev-user123-abc.company.com \                    â”‚            â”‚
â”‚  â”‚   --memory 16g \                                              â”‚            â”‚
â”‚  â”‚   --cpus 4 \                                                  â”‚            â”‚
â”‚  â”‚   -v /nfs/source:/workspace \                                 â”‚            â”‚
â”‚  â”‚   backend-api:linux-x64                                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  STEP 4: Network Setup (SRE managed, ~5s)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ a) Assign IP: 10.0.5.123                                     â”‚            â”‚
â”‚  â”‚ b) Register DNS: dev-user123-abc.company.com â†’ 10.0.5.123    â”‚            â”‚
â”‚  â”‚ c) Configure SSH access                                       â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  STEP 5: Save to Database (5ms)                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ INSERT INTO workspaces (                                      â”‚            â”‚
â”‚  â”‚   id, user_id, server_id, container_id, hostname, status     â”‚            â”‚
â”‚  â”‚ ) VALUES (                                                    â”‚            â”‚
â”‚  â”‚   'ws-789', 'user-123', 'server-2',                          â”‚            â”‚
â”‚  â”‚   'container-abc', 'dev-user123-abc.company.com', 'RUNNING'  â”‚            â”‚
â”‚  â”‚ )                                                             â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  STEP 6: Return to User                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚                                                                              â”‚
â”‚  Response:                                                                   â”‚
â”‚  {                                                                           â”‚
â”‚    "workspaceId": "ws-789",                                                 â”‚
â”‚    "hostname": "dev-user123-abc.company.com",                               â”‚
â”‚    "status": "RUNNING",                                                      â”‚
â”‚    "sshCommand": "ssh user123@dev-user123-abc.company.com"                  â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚  Total time: ~90 seconds                                                     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q3: Explain the image building process.

**Image Build Pipeline:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IMAGE BUILD PIPELINE                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  REQUEST:                                                                    â”‚
â”‚  POST /v1/users/user-123/image-schedules                                    â”‚
â”‚  {                                                                           â”‚
â”‚    "imageName": "backend-api-dev",                                          â”‚
â”‚    "project": "backend-api",                                                 â”‚
â”‚    "changeNumber": "CL-45678"                                               â”‚
â”‚  }                                                                           â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  STEP 1: Queue the Build                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    BUILD_SCHEDULE TABLE                              â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚   ID   â”‚   PROJECT   â”‚   STATUS   â”‚  WORKER   â”‚ CREATED  â”‚ CHANGE # â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚  101   â”‚ backend-api â”‚ SCHEDULED  â”‚   null    â”‚ 10:00:00 â”‚ CL-45678 â”‚    â”‚
â”‚  â”‚  100   â”‚ frontend    â”‚ IN_PROGRESSâ”‚ worker-1  â”‚ 09:55:00 â”‚ CL-45600 â”‚    â”‚
â”‚  â”‚  99    â”‚ ml-service  â”‚ COMPLETED  â”‚ worker-2  â”‚ 09:30:00 â”‚ CL-45500 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  STEP 2: Worker Claims Job (Transactional!)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                â”‚
â”‚                                                                              â”‚
â”‚  Worker-3 polls for work:                                                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ BEGIN TRANSACTION;                                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ -- Select and LOCK one scheduled job                                 â”‚    â”‚
â”‚  â”‚ SELECT * FROM build_schedule                                         â”‚    â”‚
â”‚  â”‚ WHERE status = 'SCHEDULED'                                           â”‚    â”‚
â”‚  â”‚ ORDER BY created_at                                                   â”‚    â”‚
â”‚  â”‚ LIMIT 1                                                               â”‚    â”‚
â”‚  â”‚ FOR UPDATE SKIP LOCKED;  â† Key! Skip if another worker is locking   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ -- Claim the job                                                     â”‚    â”‚
â”‚  â”‚ UPDATE build_schedule                                                 â”‚    â”‚
â”‚  â”‚ SET status = 'IN_PROGRESS',                                          â”‚    â”‚
â”‚  â”‚     worker_id = 'worker-3',                                          â”‚    â”‚
â”‚  â”‚     started_at = NOW()                                                â”‚    â”‚
â”‚  â”‚ WHERE id = 101;                                                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ COMMIT;                                                               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  Why SKIP LOCKED?                                                           â”‚
â”‚  If Worker-1 and Worker-3 poll at the same time:                            â”‚
â”‚  - Worker-1 locks row 101                                                   â”‚
â”‚  - Worker-3 skips row 101, gets next available (or waits)                   â”‚
â”‚  - NO DEADLOCK, NO DOUBLE-CLAIM!                                            â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  STEP 3: Build the Image                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚                                                                              â”‚
â”‚  Worker executes Dockerfile template:                                        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ # Dockerfile (generated from template)                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ FROM base-dev-image:linux-x64                                        â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ # Install standard tools                                             â”‚    â”‚
â”‚  â”‚ RUN apt-get update && apt-get install -y \                           â”‚    â”‚
â”‚  â”‚     curl bash vim emacs git python3 nodejs                           â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ # Configure Perforce client                                          â”‚    â”‚
â”‚  â”‚ ENV P4PORT=perforce.company.com:1666                                 â”‚    â”‚
â”‚  â”‚ ENV P4USER=build-agent                                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ # Sync source code to specific changelist                            â”‚    â”‚
â”‚  â”‚ WORKDIR /workspace                                                    â”‚    â”‚
â”‚  â”‚ RUN p4 sync //depot/backend-api/...@CL-45678                         â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ # Cache popular dependencies                                         â”‚    â”‚
â”‚  â”‚ RUN pip install -r requirements.txt                                   â”‚    â”‚
â”‚  â”‚ RUN npm install                                                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  Build time: 10-30 minutes (depends on project size)                        â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  STEP 4: Completion & Notification                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚                                                                              â”‚
â”‚  Worker â†’ A4C Service:                                                       â”‚
â”‚  POST /internal/builds/101/complete                                          â”‚
â”‚  {"status": "SUCCESS", "imageTag": "backend-api:CL-45678"}                  â”‚
â”‚                                                                              â”‚
â”‚  A4C Service:                                                                â”‚
â”‚  1. Update DB: status = 'COMPLETED'                                         â”‚
â”‚  2. Push image to all Docker hosts (or registry)                            â”‚
â”‚  3. Send email: "Your image is ready!"                                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q4: How do you handle workspace creation failures?

**Failure Handling with State Machine:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FAILURE HANDLING STATE MACHINE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Creation Steps & Their States:                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  STEP 1        STEP 2        STEP 3        STEP 4        DONE         â”‚  â”‚
â”‚  â”‚  Container     Setup         IP Assign     DNS Entry     Complete     â”‚  â”‚
â”‚  â”‚  Create        Config        (Network)     (Hostname)                 â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”       â”‚  â”‚
â”‚  â”‚  â”‚ S1 â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ S2 â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ S3 â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ S4 â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚DONEâ”‚       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”˜       â”‚  â”‚
â”‚  â”‚     â”‚            â”‚             â”‚             â”‚                        â”‚  â”‚
â”‚  â”‚     â”‚ Fail       â”‚ Fail        â”‚ Fail        â”‚ Fail                   â”‚  â”‚
â”‚  â”‚     â–¼            â–¼             â–¼             â–¼                        â”‚  â”‚
â”‚  â”‚  [Cleanup]   [Cleanup]     [Cleanup]     [Cleanup]                    â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  EXAMPLE: Failure at Step 3 (IP Assignment)                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ 1. Container created successfully    â†’ State: S1_COMPLETE           â”‚    â”‚
â”‚  â”‚ 2. Setup completed successfully      â†’ State: S2_COMPLETE           â”‚    â”‚
â”‚  â”‚ 3. IP assignment FAILS!              â†’ State: S3_FAILED             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ What's in DB:                                                        â”‚    â”‚
â”‚  â”‚ {                                                                    â”‚    â”‚
â”‚  â”‚   "workspaceId": "ws-789",                                           â”‚    â”‚
â”‚  â”‚   "state": "S3_FAILED",                                              â”‚    â”‚
â”‚  â”‚   "containerId": "container-abc",                                    â”‚    â”‚
â”‚  â”‚   "serverId": "server-2",                                            â”‚    â”‚
â”‚  â”‚   "error": "Network service timeout"                                 â”‚    â”‚
â”‚  â”‚ }                                                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  ON RETRY (only for 5xx errors):                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ function retryWorkspaceCreation(workspaceId) {                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚   workspace = db.get(workspaceId);                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚   // STEP 1: Cleanup stale resources                                 â”‚    â”‚
â”‚  â”‚   if (workspace.containerId) {                                       â”‚    â”‚
â”‚  â”‚     docker.kill(workspace.containerId);   // Kill if running         â”‚    â”‚
â”‚  â”‚     docker.rm(workspace.containerId);     // Remove container        â”‚    â”‚
â”‚  â”‚   }                                                                  â”‚    â”‚
â”‚  â”‚   if (workspace.ipAddress) {                                         â”‚    â”‚
â”‚  â”‚     network.releaseIP(workspace.ipAddress);                          â”‚    â”‚
â”‚  â”‚   }                                                                  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚   // STEP 2: Reset state                                             â”‚    â”‚
â”‚  â”‚   workspace.state = 'PENDING';                                       â”‚    â”‚
â”‚  â”‚   workspace.containerId = null;                                      â”‚    â”‚
â”‚  â”‚   db.save(workspace);                                                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚   // STEP 3: Start fresh                                             â”‚    â”‚
â”‚  â”‚   return createWorkspace(workspace);                                  â”‚    â”‚
â”‚  â”‚ }                                                                    â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  WHY NOT AUTOMATIC ROLLBACK?                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Considered: After each step failure, undo all previous steps        â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ Problems:                                                             â”‚    â”‚
â”‚  â”‚ âŒ Complex code (each step needs rollback logic)                      â”‚    â”‚
â”‚  â”‚ âŒ Rollback can also fail! (network issues, etc.)                     â”‚    â”‚
â”‚  â”‚ âŒ Hard to debug (what state are we in?)                              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚ Our approach ("clean before retry"):                                 â”‚    â”‚
â”‚  â”‚ âœ… Simple code (just cleanup + fresh start)                           â”‚    â”‚
â”‚  â”‚ âœ… Cleanup is idempotent (safe to repeat)                             â”‚    â”‚
â”‚  â”‚ âœ… Final state is always clean                                        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q5: How do you handle deletion failures?

**Cleanup Daemon Pattern:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DELETION FAILURE & CLEANUP DAEMON                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  THE PROBLEM:                                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚                                                                              â”‚
â”‚  Normal deletion flow:                                                       â”‚
â”‚  1. Delete container from Docker host                                        â”‚
â”‚  2. Delete record from database                                              â”‚
â”‚                                                                              â”‚
â”‚  What if network fails between step 1 and 2?                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  A4C Service                Docker Host              Database          â”‚  â”‚
â”‚  â”‚       â”‚                          â”‚                       â”‚             â”‚  â”‚
â”‚  â”‚       â”‚â”€â”€â”€ Delete container â”€â”€â”€â”€â–ºâ”‚                       â”‚             â”‚  â”‚
â”‚  â”‚       â”‚                          â”‚                       â”‚             â”‚  â”‚
â”‚  â”‚       â”‚â—„â”€â”€â”€ OK (deleted) â”€â”€â”€â”€â”€â”€â”€â”€â”‚                       â”‚             â”‚  â”‚
â”‚  â”‚       â”‚                          â”‚                       â”‚             â”‚  â”‚
â”‚  â”‚       â”‚â”€â”€â”€ Delete DB record â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€X             â”‚  â”‚
â”‚  â”‚       â”‚                                          NETWORK TIMEOUT!       â”‚  â”‚
â”‚  â”‚       â”‚                                                                â”‚  â”‚
â”‚  â”‚  Result:                                                               â”‚  â”‚
â”‚  â”‚  â€¢ Container: DELETED âœ“                                                â”‚  â”‚
â”‚  â”‚  â€¢ Database: STILL HAS RECORD âœ— (orphaned!)                           â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  THE SOLUTION: Cleanup Daemon                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚                                                                              â”‚
â”‚  A daemon runs on each Docker host, periodically reconciling state:        â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  CLEANUP DAEMON (runs every 5 minutes on each host)                   â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  1. List containers on this host:                                      â”‚  â”‚
â”‚  â”‚     docker ps -a --format '{{.Names}}'                                â”‚  â”‚
â”‚  â”‚     Result: [ws-123, ws-456, ws-789]                                  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  2. Query A4C: "What workspaces should be on server-2?"               â”‚  â”‚
â”‚  â”‚     GET /internal/workspaces?serverId=server-2                        â”‚  â”‚
â”‚  â”‚     Result: [ws-123, ws-456]  (ws-789 was deleted from DB!)           â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  3. Find orphaned containers:                                          â”‚  â”‚
â”‚  â”‚     Containers on host: [ws-123, ws-456, ws-789]                      â”‚  â”‚
â”‚  â”‚     Expected by DB:     [ws-123, ws-456]                              â”‚  â”‚
â”‚  â”‚     Orphaned:           [ws-789]                                      â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  4. Clean up orphans:                                                  â”‚  â”‚
â”‚  â”‚     docker rm -f ws-789                                                â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  REVERSE CASE: DB has record, container doesn't exist                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  Same daemon, opposite check:                                          â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  Expected by DB:     [ws-123, ws-456, ws-999]                         â”‚  â”‚
â”‚  â”‚  Containers on host: [ws-123, ws-456]                                 â”‚  â”‚
â”‚  â”‚  Missing:            [ws-999]                                         â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  Action:                                                               â”‚  â”‚
â”‚  â”‚  POST /internal/workspaces/ws-999/mark-deleted                        â”‚  â”‚
â”‚  â”‚  (Clean up DB record since container is gone)                         â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  KEY INSIGHT: Eventual Consistency                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚                                                                              â”‚
â”‚  We don't need IMMEDIATE consistency between Docker and DB.                 â”‚
â”‚  Within 5 minutes, daemon reconciles any discrepancies.                     â”‚
â”‚  This is much simpler than complex distributed transactions!                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q6: How do you ensure high availability?

**HA Architecture:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HIGH AVAILABILITY ARCHITECTURE                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  LAYER 1: API SERVICES                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     KUBERNETES CLUSTER                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚                   LOAD BALANCER                              â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                           â”‚                                          â”‚    â”‚
â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚    â”‚
â”‚  â”‚            â–¼              â–¼              â–¼                          â”‚    â”‚
â”‚  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚    â”‚
â”‚  â”‚       â”‚  A4C    â”‚    â”‚  A4C    â”‚    â”‚  A4C    â”‚                     â”‚    â”‚
â”‚  â”‚       â”‚ Pod #1  â”‚    â”‚ Pod #2  â”‚    â”‚ Pod #3  â”‚                     â”‚    â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â€¢ 3 replicas (can lose 2 and still work)                           â”‚    â”‚
â”‚  â”‚  â€¢ Health checks auto-restart failed pods                           â”‚    â”‚
â”‚  â”‚  â€¢ Stateless (all state in DB)                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  LAYER 2: DATABASE                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     PostgreSQL Cluster                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚                                                              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    â”‚ PRIMARY  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ REPLICA  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ REPLICA  â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    â”‚          â”‚   WAL   â”‚          â”‚   WAL   â”‚          â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    â”‚ (Writes) â”‚  Async  â”‚ (Reads)  â”‚  Async  â”‚ (Reads)  â”‚   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚    â”‚
â”‚  â”‚  â”‚                                                              â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  WAL = Write-Ahead Log (changes streamed to replicas)               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â€¢ Writes â†’ Primary only                                             â”‚    â”‚
â”‚  â”‚  â€¢ Reads â†’ Any replica (or primary)                                  â”‚    â”‚
â”‚  â”‚  â€¢ If primary fails â†’ Promote replica to primary                     â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  LAYER 3: DOCKER HOSTS                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                     Docker Host Pool                                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚ Host 1  â”‚  â”‚ Host 2  â”‚  â”‚ Host 3  â”‚  â”‚ Host 4  â”‚  â”‚ Host 5  â”‚   â”‚    â”‚
â”‚  â”‚  â”‚ (OK)    â”‚  â”‚ (OK)    â”‚  â”‚ (DOWN)  â”‚  â”‚ (OK)    â”‚  â”‚ (OK)    â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â€¢ Health checks mark unhealthy hosts                                â”‚    â”‚
â”‚  â”‚  â€¢ New workspaces routed to healthy hosts only                      â”‚    â”‚
â”‚  â”‚  â€¢ Existing workspaces on failed host are affected                  â”‚    â”‚
â”‚  â”‚    (development environments, not SLA-bound)                        â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q7: How does the Disk Service work and why is it separate?

**Disk Service Architecture:**
- Runs as a daemon on each Docker host
- Periodically collects: disk usage, memory usage, CPU, container count
- Exposes metrics via API: `GET /servers/{id}/stats`
- A4C queries this during workspace creation

**Why separate service?**
- **Single Responsibility**: A4C handles business logic, Disk Service handles host monitoring
- **Reliability**: If A4C restarts, we don't lose host stats
- **Scalability**: Disk Service can be enhanced independently (add more metrics, caching)

---

### Q8: How do you handle user quotas?

**Quota Implementation:**
```
Per-user limits:
â”œâ”€â”€ Max workspaces: 5 (configurable per user/team)
â”œâ”€â”€ Max disk per workspace: 100GB
â”œâ”€â”€ Max concurrent builds: 2
â””â”€â”€ Total storage quota: 500GB across all workspaces
```

**Enforcement:**
- Before workspace creation: `SELECT COUNT(*) FROM workspaces WHERE user_id = X`
- If count >= quota, return 429 with clear message
- Quotas stored in `user_quotas` table, with team-level defaults

---

### Q9: Explain the image registry and distribution.

**Image Flow:**
1. Worker builds image on bare-metal server
2. Image pushed to internal Docker registry
3. A4C updates `images` table with new tag
4. On workspace creation, Docker host pulls from registry

**Registry Setup:**
- Harbor registry (open-source, enterprise features)
- Replicated across data centers for HA
- Garbage collection for old unused tags

---

### Q10: How do you handle workspace stop/start?

**Stop (hibernate):**
```
docker stop {container_id}
UPDATE workspaces SET status = 'STOPPED' WHERE id = X
```
- Container state preserved on disk
- Resources freed for other workspaces
- User data still on volume

**Start (resume):**
```
docker start {container_id}
UPDATE workspaces SET status = 'RUNNING' WHERE id = X
```
- Same container, same data, same hostname
- Faster than creating new workspace

---

### Q11: What database schema do you use?

**Core Tables:**
```sql
workspaces (
  id UUID PRIMARY KEY,
  user_id VARCHAR NOT NULL,
  server_id VARCHAR NOT NULL,
  container_id VARCHAR,
  hostname VARCHAR,
  status VARCHAR,  -- CREATING, RUNNING, STOPPED, FAILED, DELETED
  image_name VARCHAR,
  tier VARCHAR,    -- standard, large, xl
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

build_schedule (
  id SERIAL PRIMARY KEY,
  project VARCHAR NOT NULL,
  arch VARCHAR NOT NULL,
  status VARCHAR,  -- SCHEDULED, IN_PROGRESS, COMPLETED, FAILED
  worker_id VARCHAR,
  started_at TIMESTAMP,
  completed_at TIMESTAMP,
  retry_count INT DEFAULT 0
)

docker_hosts (
  id VARCHAR PRIMARY KEY,
  arch VARCHAR NOT NULL,
  status VARCHAR,  -- healthy, unhealthy, draining
  disk_usage INT,
  memory_usage INT,
  last_health_check TIMESTAMP
)
```

---

### Q12: How do you handle graceful shutdown of the A4C service?

**Shutdown Sequence:**
1. Stop accepting new requests (remove from load balancer)
2. Wait for in-flight requests to complete (30s timeout)
3. Drain any background jobs
4. Close database connections
5. Exit

**Critical insight:** In-progress workspace creations are safe because:
- State is in database (can resume)
- Container creation is idempotent (cleanup daemon handles orphans)

---

### Q13: How do you test this system?

**Testing Strategy:**
```
Unit Tests:
â”œâ”€â”€ Business logic (host selection, quota checks)
â”œâ”€â”€ State machine transitions
â””â”€â”€ Input validation

Integration Tests:
â”œâ”€â”€ API endpoints with test DB
â”œâ”€â”€ Docker daemon mocking
â””â”€â”€ End-to-end workspace lifecycle

Load Tests:
â”œâ”€â”€ 100 concurrent workspace creations
â”œâ”€â”€ Host selection under contention
â””â”€â”€ Build queue performance
```

---

### Q14: What's your deployment strategy?

**Blue-Green Deployment:**
1. Deploy new version to "green" pods
2. Run smoke tests against green
3. Switch load balancer to green
4. Keep blue pods for rollback (15 minutes)
5. Terminate blue if no issues

**Database migrations:**
- Always backward compatible
- Deploy migration first, then code that uses it

---

### Q15: How do you handle secrets and configuration?

**Secrets Management:**
- Kubernetes Secrets for DB credentials, registry auth
- Mounted as environment variables or files
- Rotated quarterly via automated process

**Configuration:**
- ConfigMaps for non-sensitive config
- Feature flags for gradual rollouts
- Environment-specific overrides (dev/staging/prod)

---

## Part 2: Deep Grilling Questions (Q16-Q30)

### Q16: How do you prevent two workers from claiming the same build job? (Race Condition)

**Database Locking Deep Dive:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PREVENTING DOUBLE-CLAIM (Race Condition)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  THE RACE CONDITION:                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                        â”‚
â”‚                                                                              â”‚
â”‚  Time    Worker-1                Worker-2                Database           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”‚
â”‚  T1      SELECT * WHERE          SELECT * WHERE          Row 101:          â”‚
â”‚          status='SCHEDULED'      status='SCHEDULED'      SCHEDULED          â”‚
â”‚                                                                              â”‚
â”‚  T2      Got row 101             Got row 101                                â”‚
â”‚                                                                              â”‚
â”‚  T3      UPDATE status=          UPDATE status=          ???                â”‚
â”‚          IN_PROGRESS             IN_PROGRESS                                 â”‚
â”‚          WHERE id=101            WHERE id=101                                â”‚
â”‚                                                                              â”‚
â”‚  PROBLEM: Both workers think they own row 101!                              â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  THE SOLUTION: FOR UPDATE SKIP LOCKED                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Worker-1:                                                           â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚    â”‚
â”‚  â”‚  BEGIN;                                                              â”‚    â”‚
â”‚  â”‚  SELECT * FROM build_schedule                                        â”‚    â”‚
â”‚  â”‚  WHERE status = 'SCHEDULED'                                          â”‚    â”‚
â”‚  â”‚  ORDER BY created_at                                                  â”‚    â”‚
â”‚  â”‚  LIMIT 1                                                              â”‚    â”‚
â”‚  â”‚  FOR UPDATE SKIP LOCKED;   â† LOCKS row 101                           â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  -- Got row 101, now it's LOCKED                                     â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  UPDATE build_schedule                                                â”‚    â”‚
â”‚  â”‚  SET status = 'IN_PROGRESS', worker_id = 'worker-1'                  â”‚    â”‚
â”‚  â”‚  WHERE id = 101;                                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  COMMIT;   â† Lock released                                           â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Worker-2 (runs at same time):                                       â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚    â”‚
â”‚  â”‚  BEGIN;                                                              â”‚    â”‚
â”‚  â”‚  SELECT * FROM build_schedule                                        â”‚    â”‚
â”‚  â”‚  WHERE status = 'SCHEDULED'                                          â”‚    â”‚
â”‚  â”‚  ORDER BY created_at                                                  â”‚    â”‚
â”‚  â”‚  LIMIT 1                                                              â”‚    â”‚
â”‚  â”‚  FOR UPDATE SKIP LOCKED;                                              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  -- Row 101 is LOCKED by Worker-1                                    â”‚    â”‚
â”‚  â”‚  -- SKIP LOCKED means: skip that row, get next one                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  -- Got row 102 instead (or no rows if 101 was the only one)        â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  ALTERNATIVE: FOR UPDATE (without SKIP LOCKED)                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
â”‚                                                                              â”‚
â”‚  Worker-2 would WAIT until Worker-1 commits                                 â”‚
â”‚  Then get row 101 (but it's already IN_PROGRESS, so WHERE fails)           â”‚
â”‚  Less efficient - worker sits idle while waiting                            â”‚
â”‚                                                                              â”‚
â”‚  SKIP LOCKED is better: "If someone else has it, give me another one"     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q17: What if a worker dies during a build?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HANDLING WORKER DEATH MID-BUILD                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  SCENARIO:                                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                   â”‚
â”‚  Worker-1 claims job 101, starts building, then CRASHES                     â”‚
â”‚                                                                              â”‚
â”‚  Database state:                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   ID   â”‚    STATUS     â”‚   WORKER     â”‚  STARTED_AT  â”‚                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚  â”‚  101   â”‚  IN_PROGRESS  â”‚  worker-1    â”‚  10:00:00    â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                              â”‚
â”‚  Worker-1 is DEAD. Job 101 stuck forever as IN_PROGRESS!                    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  SOLUTION: Heartbeat + Timeout                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚                                                                              â”‚
â”‚  Option A: Worker Heartbeat                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Worker sends heartbeat every 30 seconds:                           â”‚    â”‚
â”‚  â”‚  UPDATE build_schedule                                               â”‚    â”‚
â”‚  â”‚  SET last_heartbeat = NOW()                                          â”‚    â”‚
â”‚  â”‚  WHERE id = 101 AND worker_id = 'worker-1';                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Cleanup job checks for stale builds:                                â”‚    â”‚
â”‚  â”‚  UPDATE build_schedule                                               â”‚    â”‚
â”‚  â”‚  SET status = 'SCHEDULED', worker_id = NULL, started_at = NULL       â”‚    â”‚
â”‚  â”‚  WHERE status = 'IN_PROGRESS'                                        â”‚    â”‚
â”‚  â”‚    AND last_heartbeat < NOW() - INTERVAL '5 minutes';                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Another worker will pick it up!                                     â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  Option B: Simple Timeout (what we used)                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Assume: No build should take > 2 hours                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Cleanup job (runs every 15 minutes):                               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  UPDATE build_schedule                                               â”‚    â”‚
â”‚  â”‚  SET status = 'SCHEDULED', worker_id = NULL, started_at = NULL,     â”‚    â”‚
â”‚  â”‚      retry_count = retry_count + 1                                   â”‚    â”‚
â”‚  â”‚  WHERE status = 'IN_PROGRESS'                                        â”‚    â”‚
â”‚  â”‚    AND started_at < NOW() - INTERVAL '2 hours';                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  If retry_count > 3:                                                 â”‚    â”‚
â”‚  â”‚    Mark as FAILED, alert team for investigation                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  EDGE CASE: Worker isn't dead, just slow                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚                                                                              â”‚
â”‚  Job reset while Worker-1 is still building (legitimately slow)?           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Worker-1 finishes, tries to update:                                 â”‚    â”‚
â”‚  â”‚  UPDATE build_schedule SET status = 'COMPLETED'                      â”‚    â”‚
â”‚  â”‚  WHERE id = 101 AND worker_id = 'worker-1';                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Result: 0 rows updated (worker_id no longer matches!)               â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Worker logs: "Job 101 no longer assigned to me, discarding result" â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Another worker probably rebuilt it already - that's fine!           â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q18: How do you handle resource limits?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    RESOURCE MANAGEMENT                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  CONTAINER RESOURCE LIMITS:                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  docker run \                                                        â”‚    â”‚
â”‚  â”‚    --memory="16g" \           # Hard memory limit                   â”‚    â”‚
â”‚  â”‚    --memory-swap="32g" \      # Memory + swap limit                 â”‚    â”‚
â”‚  â”‚    --cpus="4" \               # 4 CPU cores max                     â”‚    â”‚
â”‚  â”‚    --cpu-shares="1024" \      # Relative CPU weight                 â”‚    â”‚
â”‚  â”‚    --storage-opt size=100G \  # Disk quota                          â”‚    â”‚
â”‚  â”‚    --pids-limit="500" \       # Max processes                       â”‚    â”‚
â”‚  â”‚    backend-api:linux-x64                                            â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  WORKSPACE TIERS:                                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚      Tier       â”‚  Memory  â”‚   CPUs   â”‚   Disk   â”‚                       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚
â”‚  â”‚  Standard       â”‚   8 GB   â”‚    2     â”‚   50 GB  â”‚                       â”‚
â”‚  â”‚  Large          â”‚  16 GB   â”‚    4     â”‚  100 GB  â”‚                       â”‚
â”‚  â”‚  XL (approved)  â”‚  32 GB   â”‚    8     â”‚  200 GB  â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                              â”‚
â”‚  Users select tier at creation time.                                        â”‚
â”‚  XL requires manager approval (expensive resources).                        â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  HOST CAPACITY PLANNING:                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Host capacity: 256 GB RAM, 64 CPUs, 4 TB disk                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Max Standard workspaces: ~20 (160 GB RAM used, 1 TB disk)          â”‚    â”‚
â”‚  â”‚  Max Large workspaces: ~12 (192 GB RAM, 1.2 TB disk)                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  We reserve 20% headroom for system overhead                        â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Disk Service threshold:                                             â”‚    â”‚
â”‚  â”‚  â€¢ disk > 80% â†’ stop creating workspaces on this host               â”‚    â”‚
â”‚  â”‚  â€¢ memory > 90% â†’ stop creating workspaces on this host             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  HANDLING RESOURCE EXHAUSTION:                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Scenario: All hosts above threshold                                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Response:                                                           â”‚    â”‚
â”‚  â”‚  {                                                                   â”‚    â”‚
â”‚  â”‚    "error": "CAPACITY_EXHAUSTED",                                    â”‚    â”‚
â”‚  â”‚    "message": "No hosts available. Please delete unused workspaces.",â”‚    â”‚
â”‚  â”‚    "suggestion": "Try again in 30 minutes"                           â”‚    â”‚
â”‚  â”‚  }                                                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  We also:                                                            â”‚    â”‚
â”‚  â”‚  â€¢ Alert infrastructure team                                         â”‚    â”‚
â”‚  â”‚  â€¢ Send email to users with unused workspaces (> 7 days idle)       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q19: How do you handle multi-architecture support?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MULTI-ARCHITECTURE SUPPORT                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  SUPPORTED ARCHITECTURES:                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚  â”‚ Architecture â”‚ Use Case                        â”‚                          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                          â”‚
â”‚  â”‚ linux-x64    â”‚ Most backend services          â”‚                          â”‚
â”‚  â”‚ linux-arm64  â”‚ ARM-based production targets   â”‚                          â”‚
â”‚  â”‚ darwin-arm64 â”‚ macOS developers (Apple Silicon)â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  ARCHITECTURE-SPECIFIC HOSTS:                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Host Pool:                                                          â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚    â”‚
â”‚  â”‚  â”‚  Hosts 1-10 â”‚  â”‚ Hosts 11-15 â”‚  â”‚ Hosts 16-18 â”‚                  â”‚    â”‚
â”‚  â”‚  â”‚  linux-x64  â”‚  â”‚ linux-arm64 â”‚  â”‚ darwin-arm64â”‚                  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Database tracks:                                                    â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ host_id  â”‚  arch          â”‚  disk_usage  â”‚  status          â”‚    â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ host-1   â”‚  linux-x64     â”‚  45%         â”‚  healthy         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ host-11  â”‚  linux-arm64   â”‚  60%         â”‚  healthy         â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ host-16  â”‚  darwin-arm64  â”‚  30%         â”‚  healthy         â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  WORKSPACE CREATION WITH ARCH:                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  1. User requests: {"arch": "linux-arm64", "project": "ml-service"} â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  2. Find matching hosts:                                             â”‚    â”‚
â”‚  â”‚     SELECT host_id FROM hosts                                        â”‚    â”‚
â”‚  â”‚     WHERE arch = 'linux-arm64' AND status = 'healthy'                â”‚    â”‚
â”‚  â”‚     â†’ [host-11, host-12, host-13, host-14, host-15]                 â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  3. Find hosts with required image:                                  â”‚    â”‚
â”‚  â”‚     SELECT host_id FROM images                                       â”‚    â”‚
â”‚  â”‚     WHERE project = 'ml-service' AND arch = 'linux-arm64'            â”‚    â”‚
â”‚  â”‚     â†’ [host-11, host-12] (not all hosts have the image)             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  4. Select by disk usage:                                            â”‚    â”‚
â”‚  â”‚     Disk Service returns: host-11 (lower usage)                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  5. Create container on host-11                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  IMAGE BUILDING FOR EACH ARCH:                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚                                                                              â”‚
â”‚  Build workers are arch-specific:                                           â”‚
â”‚  â€¢ x64 workers build x64 images (can't build ARM on x64!)                  â”‚
â”‚  â€¢ ARM workers build ARM images                                             â”‚
â”‚  â€¢ macOS workers build Darwin images                                        â”‚
â”‚                                                                              â”‚
â”‚  Job claiming includes arch filter:                                         â”‚
â”‚  SELECT * FROM build_schedule                                                â”‚
â”‚  WHERE status = 'SCHEDULED' AND arch = 'linux-arm64'                        â”‚
â”‚  ...                                                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q20: How do you debug issues when a workspace won't start?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEBUGGING WORKSPACE ISSUES                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  COMMON ISSUES & DIAGNOSIS:                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Issue                    â”‚ Symptom              â”‚ Debug Steps         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Image not found          â”‚ Error at step 1      â”‚ Check image registryâ”‚   â”‚
â”‚  â”‚                          â”‚                      â”‚ docker images on hostâ”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ No capacity              â”‚ Error: no hosts      â”‚ Check disk thresholdsâ”‚  â”‚
â”‚  â”‚                          â”‚                      â”‚ List host usage      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Container create fails   â”‚ Error at step 3      â”‚ docker logs          â”‚   â”‚
â”‚  â”‚                          â”‚                      â”‚ Check resource limitsâ”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Network setup fails      â”‚ Error at step 4/5    â”‚ Check SRE service    â”‚   â”‚
â”‚  â”‚                          â”‚                      â”‚ DNS lookup           â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ Container starts, dies   â”‚ Status: EXITED       â”‚ docker logs <id>     â”‚   â”‚
â”‚  â”‚                          â”‚                      â”‚ Check OOM killer     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  DETAILED DEBUG WORKFLOW:                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Step 1: Get workspace details                                       â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚    â”‚
â”‚  â”‚  GET /v1/workspaces/ws-789                                           â”‚    â”‚
â”‚  â”‚  {                                                                   â”‚    â”‚
â”‚  â”‚    "id": "ws-789",                                                   â”‚    â”‚
â”‚  â”‚    "state": "S3_FAILED",      â† Failed at IP assignment              â”‚    â”‚
â”‚  â”‚    "serverId": "server-2",                                           â”‚    â”‚
â”‚  â”‚    "containerId": "abc123",                                          â”‚    â”‚
â”‚  â”‚    "error": "Network timeout calling IP service",                    â”‚    â”‚
â”‚  â”‚    "createdAt": "2024-01-15T10:00:00Z"                               â”‚    â”‚
â”‚  â”‚  }                                                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Step 2: Check logs                                                  â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚    â”‚
â”‚  â”‚  # A4C service logs                                                  â”‚    â”‚
â”‚  â”‚  kubectl logs -l app=a4c-service --since=1h | grep ws-789            â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  # Container logs on host                                            â”‚    â”‚
â”‚  â”‚  ssh server-2 "docker logs abc123"                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Step 3: Check container state                                       â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                       â”‚    â”‚
â”‚  â”‚  ssh server-2 "docker inspect abc123"                                â”‚    â”‚
â”‚  â”‚  {                                                                   â”‚    â”‚
â”‚  â”‚    "State": {                                                        â”‚    â”‚
â”‚  â”‚      "Status": "running",   â† or "exited", "created"                â”‚    â”‚
â”‚  â”‚      "ExitCode": 0,         â† non-zero = crashed                    â”‚    â”‚
â”‚  â”‚      "OOMKilled": false     â† true = out of memory                  â”‚    â”‚
â”‚  â”‚    }                                                                 â”‚    â”‚
â”‚  â”‚  }                                                                   â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Step 4: Check host resources                                        â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚    â”‚
â”‚  â”‚  ssh server-2 "df -h && free -h && docker stats --no-stream"        â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  RUNBOOK EXAMPLE: OOM Killed Container                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Symptom: Container exits immediately after start                    â”‚    â”‚
â”‚  â”‚  Cause: OOMKilled = true                                             â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  Resolution:                                                          â”‚    â”‚
â”‚  â”‚  1. Delete workspace: DELETE /v1/workspaces/ws-789                   â”‚    â”‚
â”‚  â”‚  2. Recreate with larger tier:                                       â”‚    â”‚
â”‚  â”‚     POST /v1/workspaces { "tier": "large", ... }                    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  If keeps happening:                                                 â”‚    â”‚
â”‚  â”‚  - Check if project image has memory leak                           â”‚    â”‚
â”‚  â”‚  - Update base image to use less memory on startup                  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q21: What metrics do you monitor?

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MONITORING & ALERTING                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  KEY METRICS:                                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                               â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  AVAILABILITY METRICS                                                â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚    â”‚
â”‚  â”‚  â€¢ a4c_service_health: 1 (up) or 0 (down)                           â”‚    â”‚
â”‚  â”‚  â€¢ a4c_api_errors_total{endpoint, code}: Counter                    â”‚    â”‚
â”‚  â”‚  â€¢ a4c_api_success_rate: > 99.9% expected                           â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  LATENCY METRICS                                                     â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚    â”‚
â”‚  â”‚  â€¢ workspace_creation_duration_seconds: Histogram                    â”‚    â”‚
â”‚  â”‚    - P50: < 60s, P95: < 120s, P99: < 180s                           â”‚    â”‚
â”‚  â”‚  â€¢ api_request_duration_seconds{endpoint}: Histogram                â”‚    â”‚
â”‚  â”‚    - P50: < 50ms, P99: < 500ms                                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  SATURATION METRICS                                                  â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚    â”‚
â”‚  â”‚  â€¢ host_disk_usage_percent{host}: Gauge                             â”‚    â”‚
â”‚  â”‚    - Alert if > 80%                                                  â”‚    â”‚
â”‚  â”‚  â€¢ host_memory_usage_percent{host}: Gauge                           â”‚    â”‚
â”‚  â”‚    - Alert if > 90%                                                  â”‚    â”‚
â”‚  â”‚  â€¢ build_queue_depth: Gauge                                          â”‚    â”‚
â”‚  â”‚    - Alert if > 20 (backlog forming)                                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  BUSINESS METRICS                                                    â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚    â”‚
â”‚  â”‚  â€¢ workspaces_active_total: Gauge (how many running)                â”‚    â”‚
â”‚  â”‚  â€¢ workspaces_created_total{result}: Counter (success/fail)         â”‚    â”‚
â”‚  â”‚  â€¢ workspaces_per_user: Distribution (detect outliers)              â”‚    â”‚
â”‚  â”‚  â€¢ images_built_total{result}: Counter                              â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  EXAMPLE GRAFANA DASHBOARD:                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                 â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  A4C WORKSPACE SERVICE DASHBOARD                                    â”‚    â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ Active Workspacesâ”‚  â”‚ Creation P95     â”‚  â”‚ Error Rate       â”‚  â”‚    â”‚
â”‚  â”‚  â”‚      1,234       â”‚  â”‚     87 sec       â”‚  â”‚     0.1%         â”‚  â”‚    â”‚
â”‚  â”‚  â”‚   â†‘ 5% vs yday   â”‚  â”‚   â†“ 10% vs week  â”‚  â”‚  âœ“ Normal        â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  HOST CAPACITY                                                       â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ Host    â”‚ Disk  â”‚ Memory â”‚ Workspaces â”‚ Status              â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ host-1  â”‚ 65%   â”‚ 55%    â”‚ 18         â”‚ âœ“ Healthy           â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ host-2  â”‚ 78%   â”‚ 70%    â”‚ 22         â”‚ âš ï¸ High Disk        â”‚    â”‚    â”‚
â”‚  â”‚  â”‚ host-3  â”‚ 45%   â”‚ 40%    â”‚ 12         â”‚ âœ“ Healthy           â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  BUILD QUEUE                                                         â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”‚
â”‚  â”‚  â”‚ Scheduled: 3  â”‚  In Progress: 2  â”‚  Completed Today: 45    â”‚    â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚                                                                              â”‚
â”‚  ALERT EXAMPLES:                                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ALERT: HostDiskCritical                                            â”‚    â”‚
â”‚  â”‚  expr: host_disk_usage_percent > 85                                 â”‚    â”‚
â”‚  â”‚  for: 5m                                                             â”‚    â”‚
â”‚  â”‚  severity: critical                                                  â”‚    â”‚
â”‚  â”‚  message: "Host {{ $labels.host }} disk at {{ $value }}%"           â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ALERT: WorkspaceCreationSlow                                       â”‚    â”‚
â”‚  â”‚  expr: workspace_creation_duration_seconds_p99 > 180                â”‚    â”‚
â”‚  â”‚  for: 15m                                                            â”‚    â”‚
â”‚  â”‚  severity: warning                                                   â”‚    â”‚
â”‚  â”‚  message: "P99 workspace creation > 3 minutes"                      â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  ALERT: BuildQueueBacklog                                           â”‚    â”‚
â”‚  â”‚  expr: build_queue_depth > 20                                       â”‚    â”‚
â”‚  â”‚  for: 30m                                                            â”‚    â”‚
â”‚  â”‚  severity: warning                                                   â”‚    â”‚
â”‚  â”‚  message: "{{ $value }} builds waiting, consider adding workers"    â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Q22: What happens if the Docker daemon becomes unresponsive?

**Detection:** Health check fails (TCP connect or `docker info` timeout)
**Impact:** Can't create/stop containers on that host
**Response:**
1. Mark host as `unhealthy` in database
2. Stop routing new workspaces to it
3. Existing workspaces continue running (daemon issue != container issue usually)
4. Alert on-call for investigation
5. If containers also affected, notify users with workspaces on that host

---

### Q23: How do you handle data persistence for workspaces?

**Two types of data:**
1. **Container state** - lost if container deleted
2. **User data** - persisted on mounted volumes

**Implementation:**
```
docker run -v /nfs/users/{userId}/workspace:/workspace ...
```
- NFS mount for user files (survives container deletion)
- Git repos should be pushed regularly (not our responsibility)
- Workspace images are ephemeral (can recreate from registry)

---

### Q24: What's your capacity planning approach?

**Metrics-driven planning:**
1. Track peak concurrent workspaces (1200 currently)
2. Average workspace lifespan (3 days)
3. Peak creation rate (50/hour)
4. Average tier distribution (70% standard, 25% large, 5% XL)

**Formula:**
- Hosts needed = (Peak workspaces Ã— Avg resources per workspace) / (Host capacity Ã— 0.8)
- Add 20% buffer for spikes and maintenance windows

---

### Q25: How do you handle host maintenance?

**Draining procedure:**
1. Mark host as `draining` (no new workspaces)
2. Notify users with active workspaces (email + in-app)
3. Wait for workspaces to be voluntarily deleted or migrated
4. After deadline, force-stop remaining (with warning)
5. Perform maintenance
6. Mark host as `healthy`

---

### Q26: What if a user's container is mining cryptocurrency or doing malicious things?

**Detection:**
- CPU usage monitoring (sustained 100% = suspicious)
- Network traffic analysis (unusual outbound patterns)
- User reports

**Response:**
1. Automated alert on sustained high CPU
2. Admin investigation
3. If confirmed malicious: stop container, notify user, escalate to security
4. Repeat offenders: account suspension

---

### Q27: How do you handle Docker image vulnerabilities?

**Scanning:**
- All images scanned by Trivy/Clair before deployment
- Critical vulnerabilities block image from being available
- High vulnerabilities generate warning, deadline to fix

**Remediation:**
1. Base image updated with security patches
2. Rebuild all project images with new base
3. Notify users to recreate workspaces (for security)

---

### Q28: What if you need to migrate workspaces to new hosts?

**Migration approach (workspace can't be live-migrated):**
1. Create new workspace on target host
2. User migrates their data (git clone, copy files)
3. User deletes old workspace

**For forced migration (host decommissioning):**
- Same process but with deadline
- We provide tooling: `a4c migrate ws-123 --to host-5`
- Automates: create new, rsync data, update DNS, delete old

---

### Q29: How does authentication and authorization work?

**Authentication:**
- SSO via company OIDC provider
- API uses JWT tokens (1 hour expiry, refresh tokens)
- Service-to-service uses mTLS

**Authorization:**
- Users can only see/modify their own workspaces
- Admins can see all, manage quotas
- Team leads can see team workspaces
- RBAC stored in database, checked on every request

---

### Q30: What would you change if redesigning from scratch?

**Changes I'd make:**
1. **Kubernetes from day 1** - better scheduling, resource management
2. **CDC for audit logs** - capture all state changes automatically
3. **Event-driven architecture** - decouple workspace lifecycle events
4. **Better migration tooling** - live migration with minimal downtime
5. **Self-service quotas** - let managers approve without admin involvement

---

## Quick Reference Cards

### API Endpoints Cheat Sheet
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    A4C API QUICK REFERENCE                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  WORKSPACE MANAGEMENT                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚  POST   /v1/users/{userId}/workspaces           Create workspace            â”‚
â”‚  GET    /v1/users/{userId}/workspaces           List user's workspaces      â”‚
â”‚  GET    /v1/workspaces/{workspaceId}            Get workspace details       â”‚
â”‚  DELETE /v1/users/{userId}/workspaces/{id}      Delete workspace            â”‚
â”‚                                                                              â”‚
â”‚  IMAGE MANAGEMENT                                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  POST   /v1/users/{userId}/image-schedules      Schedule image build        â”‚
â”‚  GET    /v1/image-schedules/{id}                Get build status            â”‚
â”‚                                                                              â”‚
â”‚  INTERNAL (Service-to-Service)                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚  GET    /internal/workspaces?serverId=X         Workspaces on server        â”‚
â”‚  POST   /internal/builds/{id}/complete          Mark build complete         â”‚
â”‚  POST   /internal/workspaces/{id}/mark-deleted  Cleanup orphan record       â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Troubleshooting Quick Reference
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TROUBLESHOOTING QUICK REFERENCE                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Symptom                    â”‚ Check                    â”‚ Fix                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  "No hosts available"       â”‚ Host disk/memory usage   â”‚ Delete old WS      â”‚
â”‚                             â”‚ Host health status       â”‚ Add more hosts     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  "Image not found"          â”‚ Image registry           â”‚ Trigger build      â”‚
â”‚                             â”‚ Arch compatibility       â”‚ Check arch flag    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Container crashes (OOM)    â”‚ docker inspect (OOMKill) â”‚ Use larger tier    â”‚
â”‚                             â”‚ Memory limits            â”‚ Fix memory leak    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  SSH connection refused     â”‚ Container status         â”‚ Restart container  â”‚
â”‚                             â”‚ DNS resolution           â”‚ Check hostname     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Build stuck IN_PROGRESS    â”‚ Worker health            â”‚ Reset build status â”‚
â”‚                             â”‚ last_heartbeat           â”‚ Kill/restart workerâ”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
